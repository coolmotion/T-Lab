{% extends 'base.html' %}
{% block content %}
<div class="animated-text  p-4"  >
    <h2 class="text-3xl font-bold text-white text-left mt-20 m-8 text-center">Shopping Cart</h2>
</div>
      <div class="flex flex-col md:flex-row md:space-x-4   text-white px-6" >
        <div class="w-full md:w-3/4 bg-gray-100 rounded-xl p-4 mb-4 ">
          <h2 class="text-xl font-semibold m-4 text-black"> Items</h2>
          {% if cart_products %}
          {% for product in cart_products %}
          <div class="border border-gray-200 bg-gray-100 rounded-xl">
            <div class="flex mb-4 mx-2">
              <img src="{{product.image.url}}" alt="Product Image" class="w-20 h-20 object-cover rounded mr-4">
              <div class="flex flex-col">
                <span class="text-md font-semibold text-black" >{{ product.name }}</span>
                <div class="flex items-center mt-2">
                  <div class="flex flex-col items-center md:flex-row justify-start">
                  <div class="flex flex-row items-center">
                    <span class="text-gray-600 mr-2 text-sm">Qty:</span>
                    <select id="select{{product.id}}" name="quantity" class="mt-1 text-gray-600 block w-24 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-orange-500 focus:border-orange-500 sm:text-sm rounded-md">
                      {% for key, value in quantities.items %}
                          {% if key == product.id|slugify %}
                      <option selected>{{value}}</option>
                          {% endif %}
                      {% endfor %}
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                      <option value="5">5</option>
                      </select>
                      </div>
                 <button type="button" data-index="{{product.id}}" class="update-cart text-red-500 hover:text-red-700 focus:outline-none ml-4">Update</button>
                 <button class="text-red-500 hover:text-red-700 focus:outline-none ml-4">Remove</button>
                 <p class="text-sm text-black font-bolds ml-4">Rs {{product.price}}</p>
                 </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
          <h2 class="text-xl font-semibold m-4 text-black"> Shipping Information</h2>
          <p class="text-gray-600 text-xs m-4">Please fill your shipping Information</p>
          <div class="m-4 border border-gray-400 rounded-md p-4 w-full md:w-3/4"> <form method="POST" action="{% url 'billing_info'%}" >      
             {{shipping_form.as_p}} 
             {% csrf_token %}
            <button type="submit" class="flex m-4 mt-4 rounded-full bg-orange-500 px-4 py-2 text-sm font-semibold leading-6 text-white shadow-sm hover:bg-orange-600 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-orange-500">Checkout</button>
            </form>
          </div>
          {% else %}
            <p class="text-sm text-black text-left p-4">There is nothing in the cart</p>
           {% endif %}
        </div>
        <div class="w-full md:w-1/4 bg-gray-100 rounded-xl p-4 mb-4 " style="height: fit-content;">
          <h2 class="text-xl font-semibold m-4 text-black">Order Summary</h2>
          <div class="border border-gray-400 rounded-md p-4">
            <div class="flex justify-between mb-2 text-gray-900">
              <span>Items</span>
              <span></span>
            </div>
            <hr class="my-2">
            {% for product in cart_products %}
            <div class="flex justify-between mb-2 text-gray-600 text-xs">
              <span>{{product.name}}

              </span>
              <span class="inline-block">{% for key, value in quantities.items %}
                {% if key == product.id|slugify %}  
                {{value}} X
                {% endif %}
                {% endfor %}Rs{{product.price}}</span>
            </div>
            {% endfor %}
            <hr class="my-2">
            <div class="flex justify-between mb-2 text-gray-900">
              <span>Subtotal</span>
              <span>Rs {{total}}</span>
            </div>
            <div class="flex justify-between mb-2 text-gray-900">
              <span>Shipping</span>
              <span>Free</span>
            </div>
            <div class="flex justify-between mb-2 text-orange-500">
              <span>Discount</span>
              <span>-$0.00</span>
            </div>
            <hr class="my-2">
            <div class="flex justify-between font-semibold text-sm text-black">
              <span>Total</span>
              <span>Rs {{total}}</span>
            </div>
          </div>
        </div>
      </div>
      
      

      </div>
  
      

</div>

<script>
    $(document).on('click', '.update-cart', function(e){
    e.preventDefault();
    var productid = $(this).data('index');
    $.ajax({
      type: 'POST',
      url: "{% url 'cart_update' %}", // Added a missing comma here
      data: {
        product_id: $(this).data('index'), // Added quotes around the keys
        product_qty: $('#select' + productid + ' option:selected').text(),
        csrfmiddlewaretoken: '{{ csrf_token }}', // Corrected the typo in 'csrfmiddlewaretoken'
        action: 'post'
      },
  
      success: function(json){
       location.reload();
      },
      error: function(xhr, errmsg, err){ // Added a comma between xhr and errmsg
        // Handle error here
      }
  
    });
  });
</script>
{% endblock %}